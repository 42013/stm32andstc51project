C51 COMPILER V9.54   MAIN                                                                  04/07/2023 21:02:38 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <intrins.h>
   3          sbit IN1=P1^1;
   4          sbit IN2=P1^2;
   5          sbit IN3=P1^3;
   6          sbit IN4=P1^4;
   7          
   8          sbit EN1A=P2^1;
   9          sbit EN2A=P2^2;
  10          sbit left_light=P1^5;
  11          sbit middle_light=P1^7;
  12          sbit right_light=P1^6;
  13          sbit PWM = P2^0;
  14          
  15          unsigned char counter=0;
  16          unsigned char compareA,compareB;
  17          unsigned char count=0;
  18          unsigned char PWM_count=15;
  19          
  20          /*void Delay1000ms()    //@11.0592MHz
  21          {
  22            unsigned char i, j, k;
  23          
  24            _nop_();
  25            i = 8;
  26            j = 1;
  27            k = 243;
  28            do
  29            {
  30              do
  31              {
  32                while (--k);
  33              } while (--j);
  34            } while (--i);
  35          }
  36          void delay_ms(unsigned int n)
  37          {
  38              unsigned int i,y;
  39              for(i=n;i>0;i--)
  40                  for(y=114;y>0;y--);
  41          }*/
  42          void Timer0Init()
  43          {
  44   1        TMOD |= 0x01;
  45   1        TL0 = 0xA4; 
  46   1        TH0 = 0xFF; 
  47   1        TF0 = 0;
  48   1        EA=1;
  49   1        ET0=1;
  50   1        TR0 = 1;
  51   1      }
  52          void carlm_go()           //左电机直行
  53          {
  54   1        IN1=0;
C51 COMPILER V9.54   MAIN                                                                  04/07/2023 21:02:38 PAGE 2   

  55   1        IN2=1;
  56   1      }
  57          void carrm_go()           //右电机直行
  58          {
  59   1        IN3=1;
  60   1        IN4=0;
  61   1      }
  62          void carlm_back()         //左电机后退
  63          {
  64   1        IN1=0;
  65   1        IN2=1;
  66   1      }
  67          void carrm_back()          //右电机后退
  68          {
  69   1        IN3=1;
  70   1        IN4=0;
  71   1      }
  72          void carlm_stop()          //左电机停止
  73          {
  74   1        IN1=0;
  75   1        IN2=0;
  76   1      }
  77          void carrm_stop()          //右电机停止
  78          {
  79   1        IN3=0;
  80   1        IN4=0;
  81   1      }
  82          void car_go()              //小车前进
  83          {
  84   1      PWM_count=14;
  85   1      compareB=80;
  86   1      compareA=80;
  87   1      carlm_go();
  88   1      carrm_go();
  89   1      }
  90          void car_stop()            //小车停止
  91          {
  92   1      PWM_count=15;
  93   1      compareB=80;
  94   1      compareA=80;
  95   1      carlm_stop();
  96   1      carrm_stop();
  97   1      }
  98          void car_back()            //小车后退
  99          {
 100   1      PWM_count=12;
 101   1      compareB=80;
 102   1      compareA=70;
 103   1      carlm_back();
 104   1      carrm_back();
 105   1      }
 106          void car_goright()         //小车前右
 107          {
 108   1      PWM_count=10;
 109   1      compareB=70;
 110   1      compareA=80;
 111   1      carlm_go();
 112   1      carrm_go();
 113   1      }
 114          void car_goleft()          //小车前左
 115          {
 116   1      PWM_count=18;
C51 COMPILER V9.54   MAIN                                                                  04/07/2023 21:02:38 PAGE 3   

 117   1      compareB=80;
 118   1      compareA=70;
 119   1      carlm_go();
 120   1      carrm_go();}
 121          void car_inplaceleft()     //小车原地左
 122          {
 123   1      PWM_count=19;
 124   1      compareB=80;
 125   1      compareA=50;
 126   1      carlm_go();
 127   1      carrm_go();
 128   1      }
 129          void car_inplaceright()    //小车原地右
 130          {
 131   1      PWM_count=11;
 132   1      compareB=50;
 133   1      compareA=80;
 134   1      carlm_go();
 135   1      carrm_go();
 136   1      }
 137          void Infrared_tracking()    //红外循迹模块
 138          { 
 139   1        if(left_light==1&&middle_light==1&&right_light==1)//全黑
 140   1        {
 141   2          car_go();
 142   2        }
 143   1        if(left_light==0&&middle_light==1&&right_light==0)//直线
 144   1        {
 145   2          car_go();
 146   2        }
 147   1        if(left_light==1&&middle_light==0&&right_light==0)//大右转
 148   1        {
 149   2          car_inplaceright();
 150   2            if(left_light==0&&middle_light==1&&right_light==0)
 151   2            {
 152   3            car_go();
 153   3            }
 154   2        }
 155   1      
 156   1        if(left_light==0&&middle_light==0&&right_light==1)//大左转
 157   1        { 
 158   2          car_inplaceleft();
 159   2            if(left_light==0&&middle_light==1&&right_light==0)
 160   2            {
 161   3            car_go();
 162   3            }
 163   2        }
 164   1        if(left_light==1&&middle_light==1&&right_light==0)//左
 165   1        {
 166   2          car_goleft();
 167   2          if(left_light==0&&middle_light==1&&right_light==0)
 168   2          {
 169   3            car_go();
 170   3          }
 171   2      
 172   2        }
 173   1        if(left_light==0&&middle_light==1&&right_light==1)//右
 174   1        {
 175   2          car_goright();
 176   2          if(left_light==0&&middle_light==0&&right_light==0)
 177   2          {
 178   3            car_go();
C51 COMPILER V9.54   MAIN                                                                  04/07/2023 21:02:38 PAGE 4   

 179   3          }
 180   2      
 181   2        }
 182   1      
 183   1      }
 184          
 185          void main()
 186          { 
 187   1        Timer0Init();
 188   1        
 189   1        while(1)
 190   1        {
 191   2          Infrared_tracking();
 192   2        }
 193   1      }
 194          void Timer0_Routine() interrupt 1
 195          {
 196   1        TL0=0xA4;
 197   1        TH0=0xFF;
 198   1        compareA=90;
 199   1        compareB=90;
 200   1        counter++;
 201   1        if(counter>=100)
 202   1        {
 203   2         counter=0;
 204   2        }
 205   1        if(counter<compareA)
 206   1        {
 207   2          EN1A=1;
 208   2      
 209   2        }
 210   1        else
 211   1        {
 212   2          EN1A=0;
 213   2      
 214   2        }
 215   1        if(counter<compareB)
 216   1        {
 217   2          EN2A=1;
 218   2      
 219   2        }
 220   1        else
 221   1        {
 222   2          EN2A=0;
 223   2      
 224   2        }
 225   1        count++;
 226   1        count%=200;
 227   1        if(count <PWM_count) 
 228   1        { 
 229   2          PWM = 1; 
 230   2        }
 231   1        else 
 232   1        { 
 233   2          PWM = 0; 
 234   2        }
 235   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    366    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.54   MAIN                                                                  04/07/2023 21:02:38 PAGE 5   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
