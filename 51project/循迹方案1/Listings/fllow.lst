C51 COMPILER V9.54   FLLOW                                                                 04/18/2023 20:48:07 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE FLLOW
OBJECT MODULE PLACED IN .\Objects\fllow.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE fllow.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\fllow
                    -.lst) OBJECT(.\Objects\fllow.obj)

line level    source

   1          #include "reg52.h"
   2          #include <intrins.h>
   3          
   4          sbit IN1 = P1^1;
   5          sbit IN2 = P1^2;
   6          sbit IN3 = P1^3;
   7          sbit IN4 = P1^4;
   8          sbit ENA        =P2^1;
   9          sbit ENB        =P2^2;
  10          sbit left_light = P1^5;
  11          sbit right_light = P1^6;
  12          sbit middle_light=P1^7;
  13          sbit PWM = P2^0;  //设定PWM输出的I/O端口
  14          
  15          unsigned char pwm_left_val=120;
  16          unsigned char pwm_right_val=120;
  17          unsigned char pwm_t;
  18          unsigned char counter=0;
  19          unsigned char count = 0;
  20          unsigned char timer1 ;
  21          
  22          /*
  23          对于180°舵机
  24          t = 0.5ms——————-舵机会转动 0 ° 
  25          t = 1.0ms——————-舵机会转动 45°
  26          t = 1.5ms——————-舵机会转动 90°
  27          t = 2.0ms——————-舵机会转动 135°
  28          t = 2.5ms——————-舵机会转动 180°
  29          */
  30          
  31          void Timer0_Init()           
  32          {
  33   1          TMOD &= 0x00;
  34   1          TMOD |= 0x01; //定时器T0设置成方式1
  35   1       
  36   1          TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  37   1          TL0 = 0xa4;
  38   1       
  39   1          ET0 = 1;      
  40   1          TR0 = 1; 
  41   1                      EA=1; 
  42   1              }
  43          void Time0_Init() interrupt 1 
  44          {
  45   1              TR0 = 0; 
  46   1              TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  47   1          TL0 = 0xa4;
  48   1       
  49   1              if(count <= timer1) //5==0° 15==90°
  50   1              { 
  51   2                      PWM = 1; 
  52   2              }
  53   1              else 
  54   1              { 
C51 COMPILER V9.54   FLLOW                                                                 04/18/2023 20:48:07 PAGE 2   

  55   2                      PWM = 0; 
  56   2              }
  57   1              count++;
  58   1              if (count >= 200) //T = 20ms清零
  59   1              { 
  60   2                      count = 0; 
  61   2              }
  62   1              TR0 = 1; //开启T0
  63   1      }
  64          
  65           void Timer1_Init()             //100微秒@12.000MHz
  66          {
  67   1              //TMOD &= 0x0F;         //设置定时器模式
  68   1              //TL1 = 0x50;           //设置定时初值
  69   1              //TH1 = 0xFB;           //设置定时初值
  70   1              //TF1 = 0;               //清除TF1标志
  71   1              //TR1 = 1;              //定时器1开始计时
  72   1              //EA    =       1;
  73   1              //ES    =       1;
  74   1                              TMOD|=0x02;//八位重装模块
  75   1                              TH1=256;
  76   1                              TL1=256;//11.0592M晶振下最大比值是256，输出100HZ
  77   1                              TR1=1;//启动定时器1
  78   1                              ET1=1;//允许定时器1中断
  79   1                              EA=1;//总中断允许
  80   1      }
  81          
  82          /*延时程序*/
  83          void delay1s()   //误差 0us
  84          {
  85   1          unsigned char a,b,c;
  86   1          for(c=167;c>0;c--)
  87   1              for(b=171;b>0;b--)
  88   1                  for(a=16;a>0;a--);
  89   1          _nop_();  //if Keil,require use intrins.h
  90   1      }
  91           /*void delay(unsigned int xms)         //@12.000MHz
  92          {       
  93                  unsigned char i;
  94                  while(xms--)
  95                  {
  96                  _nop_();
  97                  i = 2;
  98                  while (--i);
  99                  }
 100          }*/
 101          
 102          /*定时器T0初始化*/
 103          
 104          void goForward()
 105          {
 106   1                      IN1= 0;  IN2=1;
 107   1                      IN3 = 1;IN4=0;
 108   1              pwm_left_val=110;
 109   1              pwm_right_val=110;
 110   1                      timer1=12;
 111   1      }
 112          void godown1()
 113          {
 114   1                      IN1= 1;  IN2=0;
 115   1                      IN3 =0; IN4=1;
 116   1              pwm_left_val=110;
C51 COMPILER V9.54   FLLOW                                                                 04/18/2023 20:48:07 PAGE 3   

 117   1              pwm_right_val=110;
 118   1                      timer1=10;
 119   1      }
 120          void godown2()
 121          {
 122   1                      IN1= 1;  IN2=0;
 123   1                      IN3 =0; IN4=1;
 124   1              pwm_left_val=110;
 125   1              pwm_right_val=110;
 126   1                      timer1=14;
 127   1      }
 128          /*void gostop()
 129          {
 130                          IN1= 0;  IN2=0;
 131                          IN3 = 1;IN4=1;
 132                          timer1=10;
 133          }*/
 134          void goright(){
 135   1              IN1= 0; IN2=1;
 136   1                      IN3 = 1;IN4=0;
 137   1              pwm_left_val=130;
 138   1              pwm_right_val=110;
 139   1              timer1=10;
 140   1      }
 141          void goleft(){ 
 142   1                      IN1= 0;  IN2=1;
 143   1                      IN3 = 1;IN4=0;
 144   1              pwm_left_val=110;
 145   1              pwm_right_val=130;
 146   1              timer1=13;
 147   1      }
 148          void putleft(){
 149   1              IN1= 0;  IN2=1;
 150   1                      IN3 = 1;IN4=0;
 151   1              pwm_left_val=140;
 152   1              pwm_right_val=100;
 153   1              timer1=14;
 154   1      }
 155          void putright(){
 156   1                      IN1= 0;  IN2=1;
 157   1                      IN3 = 1;IN4=0;
 158   1              pwm_left_val=100;
 159   1              pwm_right_val=140;
 160   1              timer1=9;
 161   1      }
 162          void tracingMode()    
 163          {       
 164   1              if(left_light==1&&middle_light==1&&right_light==1)//ȫۚ
 165   1              {
 166   2                      goForward();
 167   2              }
 168   1              if(left_light==0&&middle_light==1&&right_light==0)//ֱП
 169   1              {      
 170   2                      goForward();
 171   2              }
 172   1              if(left_light==1&&middle_light==0&&right_light==0)//ճԒת
 173   1              {
 174   2                      putright();
 175   2                              if(left_light==0&&middle_light==1&&right_light==0)
 176   2                              {
 177   3                              goForward();
 178   3                              }
C51 COMPILER V9.54   FLLOW                                                                 04/18/2023 20:48:07 PAGE 4   

 179   2              }
 180   1      
 181   1              if(left_light==0&&middle_light==0&&right_light==1)//ճسת
 182   1              {
 183   2                              putleft();
 184   2                              if(left_light==0&&middle_light==1&&right_light==0)
 185   2                              {
 186   3                                      goForward();
 187   3                              }
 188   2              } 
 189   1              if(left_light==1&&middle_light==1&&right_light==0)
 190   1              {
 191   2                              goleft();
 192   2                      if(left_light==0&&middle_light==1&&right_light==0)
 193   2                      {
 194   3                      goForward();
 195   3                      }
 196   2              }
 197   1              if(left_light==0&&middle_light==1&&right_light==1)
 198   1              {
 199   2                      goright();
 200   2      
 201   2                      if(left_light==0&&middle_light==0&&right_light==0)
 202   2                      {
 203   3                              goForward();
 204   3                      }
 205   2              }
 206   1      }
 207          
 208          void main()
 209          {
 210   1                              Timer0_Init();
 211   1                              Timer1_Init();
 212   1              while(1){
 213   2                      tracingMode();
 214   2              }
 215   1      }
 216          
 217          void Time1_Init() interrupt 3
 218          {
 219   1                              TR1=1;//启动定时器0
 220   1                              TH1=236;
 221   1                              TL1=236;//11.0592M晶振下最大比值是256，输出100HZ
 222   1                      pwm_t++;
 223   1                      if(pwm_t==225)
 224   1                                      pwm_t=ENA=ENB=0;
 225   1                      if(pwm_left_val==pwm_t)
 226   1                                      ENA=1;
 227   1                      if(pwm_right_val==pwm_t)
 228   1                                      ENB=1;
 229   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    395    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.54   FLLOW                                                                 04/18/2023 20:48:07 PAGE 5   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
