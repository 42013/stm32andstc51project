C51 COMPILER V9.54   FLLOW                                                                 04/07/2023 19:38:28 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE FLLOW
OBJECT MODULE PLACED IN .\Objects\FLLOW.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE FLLOW.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\FLLOW
                    -.lst) TABS(2) OBJECT(.\Objects\FLLOW.obj)

line level    source

   1          #include "reg52.h"
   2          #include <intrins.h>
   3          
   4          sfr AUXR=0x80; 
   5          sbit IN1 = P1^1;
   6          sbit IN2 = P1^2;
   7          sbit IN3 = P1^3;
   8          sbit IN4 = P1^4;
   9          sbit ENA  =P2^1;
  10          sbit ENB  =P2^2;
  11          sbit left_light = P1^5;
  12          sbit right_light= P1^6;
  13          sbit middle_light=P1^7;
  14          sbit PWM = P3^7;  //设定PWM输出的I/O端口
  15          
  16          unsigned char pwm_left=210;
  17          unsigned char pwm_right=210;
  18          unsigned char pwm_t;
  19          unsigned char count = 0;
  20          unsigned char timer1 ; 
  21          char leftSpeed;
  22          char rightSpeed;
  23          int cntLeft = 0;
  24          int cntRight = 0;
  25          
  26          /*
  27          对于180°舵机
  28          t = 0.5ms——————-舵机会转动 0 ° 
  29          t = 1.0ms——————-舵机会转动 45°
  30          t = 1.5ms——————-舵机会转动 90°
  31          t = 2.0ms——————-舵机会转动 135°
  32          t = 2.5ms——————-舵机会转动 180°
  33          */
  34          void Timer0_Init()           
  35          {
  36   1          TMOD &= 0x00;
  37   1          TMOD |= 0x01; //定时器T0设置成方式1
  38   1       
  39   1          //TL0 = 0x50;   //设置定时初值
  40   1      //  TH0 = 0xFB;   //设置定时初值
  41   1        TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  42   1          TL0 = 0xa4;
  43   1          ET0 = 1;      
  44   1          TR0 = 1; 
  45   1        EA=1; 
  46   1        }
  47          void Time0Init() interrupt 1 
  48          {
  49   1        TR0 = 0; 
  50   1        TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  51   1          TL0 = 0xa4;
  52   1        if(count <= timer1) //5==0° 15==90°
  53   1        { 
  54   2          PWM = 1; 
C51 COMPILER V9.54   FLLOW                                                                 04/07/2023 19:38:28 PAGE 2   

  55   2        }
  56   1        else 
  57   1        { 
  58   2          PWM = 0; 
  59   2        }
  60   1        count++;
  61   1        if (count >= 200) //T = 20ms清零
  62   1        { 
  63   2          count = 0; 
  64   2        }
  65   1        TR0 = 1; //开启T0
  66   1      }
  67          
  68           void Timer1Init()    //100微秒@12.000MHz
  69          {
  70   1        TMOD &= 0x0F;   //设置定时器模式
  71   1        TL1 = 0x50;   //设置定时初值
  72   1        TH1 = 0xFB;   //设置定时初值
  73   1        TF1 = 0;     //清除TF1标志
  74   1        TR1 = 1;    //定时器1开始计时
  75   1        EA  = 1;
  76   1        ES  = 1;
  77   1      }
  78          
  79          /*延时程序*/
  80          /*void delay1s()   //误差 0us
  81          {
  82              unsigned char a,b,c;
  83              for(c=167;c>0;c--)
  84                  for(b=171;b>0;b--)
  85                      for(a=16;a>0;a--);
  86              _nop_();  //if Keil,require use intrins.h
  87          }*/
  88          /* void delay(unsigned int xms)   //@12.000MHz
  89          { 
  90            unsigned char i;
  91            while(xms--)
  92            {
  93            _nop_();
  94            i = 2;
  95            while (--i);
  96            }
  97          }*/
  98          
  99          /*定时器T0初始化*/
 100          /*void Timer0_Init()           
 101          {
 102              TMOD &= 0x00;
 103              TMOD |= 0x01; //定时器T0设置成方式1
 104           
 105              TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
 106              TL0 = 0xa4;
 107           
 108              ET0 = 1;      
 109              TR0 = 1; 
 110            EA=1; 
 111            }*/
 112            
 113          /*void godown()
 114          {
 115              IN1= 1;  IN2=0;
 116              IN3 = 0;  IN4=1;
C51 COMPILER V9.54   FLLOW                                                                 04/07/2023 19:38:28 PAGE 3   

 117          }*/
 118          void goForward()
 119          {
 120   1          IN1= 0;  IN2=1;
 121   1          IN3 = 1;  IN4=0;
 122   1          timer1=12;
 123   1      }
 124          
 125          void goright(){
 126   1        IN1= 0;  IN2=1;
 127   1          IN3 = 1;  IN4=0;
 128   1        timer1=10;
 129   1      }
 130          void goleft(){
 131   1          IN1= 0;  IN2=1;
 132   1          IN3 = 1;  IN4=0;
 133   1        timer1=14;
 134   1      }
 135          void putleft(){
 136   1        IN1= 0;  IN2=1;
 137   1          IN3 = 1;  IN4=0;
 138   1        timer1=15;
 139   1      }
 140          void putright(){
 141   1        IN1= 0;  IN2=1;
 142   1          IN3 = 1;  IN4=0;
 143   1        timer1=9;
 144   1      }
 145          void goForwardup()
 146          {
 147   1        leftSpeed = 16;
 148   1        rightSpeed = 24;
 149   1      }
 150          void tracingMode()    
 151          { 
 152   1        if(left_light==1&&middle_light==1&&right_light==1)//ȫۚ
 153   1        {
 154   2          goForward();
 155   2        }
 156   1        if(left_light==0&&middle_light==1&&right_light==0)//ֱП
 157   1        {
 158   2          goForward();
 159   2        }
 160   1        if(left_light==1&&middle_light==0&&right_light==0)//ճԒת
 161   1        {
 162   2          putleft();
 163   2            if(left_light==0&&middle_light==1&&right_light==0)
 164   2            {
 165   3            goForward();
 166   3            }
 167   2        }
 168   1      
 169   1        if(left_light==0&&middle_light==0&&right_light==1)//ճسת
 170   1        { 
 171   2          putright();
 172   2            if(left_light==0&&middle_light==1&&right_light==0)
 173   2            {
 174   3            goForward();
 175   3            }
 176   2        }
 177   1        if(left_light==1&&middle_light==1&&right_light==0)//س
 178   1        {
C51 COMPILER V9.54   FLLOW                                                                 04/07/2023 19:38:28 PAGE 4   

 179   2          goleft();
 180   2          if(left_light==0&&middle_light==1&&right_light==0)
 181   2          {
 182   3            goForward();
 183   3          }
 184   2      
 185   2        }
 186   1        if(left_light==0&&middle_light==1&&right_light==1)//Ԓ
 187   1        {
 188   2          goright();
 189   2          if(left_light==0&&middle_light==0&&right_light==0)
 190   2          {
 191   3            goForward();
 192   3          }
 193   2        }
 194   1      }
 195          void main()
 196          {
 197   1        Timer0_Init();
 198   1        Timer1Init();
 199   1        while(1){
 200   2          goForward();
 201   2          tracingMode();
 202   2          goForwardup();
 203   2        }
 204   1      }
 205          
 206           void Time1Handler() interrupt 3
 207          {
 208   1        TL1 = 0x50;   //设置定时初值
 209   1        TH1 = 0xFB;   //设置定时初值
 210   1          pwm_t++;
 211   1          if(pwm_t==255)
 212   1              pwm_t=ENA=ENB=0;
 213   1          if(pwm_left==pwm_t)
 214   1          {
 215   2              ENA=1;
 216   2          }else{
 217   2            ENA=0;
 218   2          }
 219   1          if(pwm_right==pwm_t){
 220   2              ENB=1;
 221   2          }else{
 222   2          ENB=0;
 223   2          }
 224   1          /*cntLeft++;
 225   1        cntRight++;
 226   1        if(cntLeft < leftSpeed&&cntRight < rightSpeed)
 227   1        {
 228   1          goForward();
 229   1        }else{
 230   1          gostop();
 231   1        }
 232   1        if(cntLeft == 20&&cntRight == 20){
 233   1          cntLeft = 0;
 234   1          cntRight = 0;
 235   1        }*/
 236   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    337    ----
C51 COMPILER V9.54   FLLOW                                                                 04/07/2023 19:38:28 PAGE 5   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
