C51 COMPILER V9.54   AVOID                                                                 04/21/2023 20:43:48 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AVOID
OBJECT MODULE PLACED IN .\Objects\avoid.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE avoid.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\avoid
                    -.lst) OBJECT(.\Objects\avoid.obj)

line level    source

   1          #include "reg52.h"
   2          #include <intrins.h>
   3          
   4          sbit IN1 = P1^1;
   5          sbit IN2 = P1^2;
   6          sbit IN3 = P1^3;
   7          sbit IN4 = P1^4;
   8          sbit ENA=P2^1;
   9          sbit ENB=P2^2;
  10          sbit left_light = P1^5;
  11          sbit right_light = P1^6;
  12          sbit middle_light=P1^7;
  13          sbit PWM = P2^0;  //设定PWM输出的I/O端口(舵机)
  14          sbit xhg        =P1^0;
  15          
  16          unsigned char pwm_left_val;
  17          unsigned char pwm_right_val;
  18          unsigned char pwm_t;
  19          unsigned char count = 0;
  20          unsigned char timer1; 
  21          float distance;
  22          void delay1s()   //误差 0us
  23          {
  24   1          unsigned char a,b,c;
  25   1          for(c=167;c>0;c--)
  26   1              for(b=171;b>0;b--)
  27   1                  for(a=16;a>0;a--);
  28   1          _nop_();  //if Keil,require use intrins.h
  29   1      }
  30          void Timer0_Init()              //100微秒@12.000MHz
  31          {
  32   1              TMOD &= 0x00;
  33   1          TMOD |= 0x01; //定时器T0设置成方式1
  34   1       
  35   1          TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  36   1          TL0 = 0xa4;
  37   1       
  38   1          ET0 = 1;      
  39   1          TR0 = 1; 
  40   1              EA=1; 
  41   1      }
  42          void Time0Init() interrupt 1 
  43          {
  44   1                      TR0 = 0; 
  45   1                      TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  46   1          TL0 = 0xa4;
  47   1              if(count <= timer1) //5==0° 15==90°
  48   1              { 
  49   2                      PWM = 1; 
  50   2              }
  51   1              else 
  52   1              { 
  53   2                      PWM = 0; 
  54   2              }
C51 COMPILER V9.54   AVOID                                                                 04/21/2023 20:43:48 PAGE 2   

  55   1              count++;
  56   1              if (count >= 200) //T = 20ms清零
  57   1              { 
  58   2                      count = 0; 
  59   2              }
  60   1              TR0 = 1; //开启T0
  61   1      }
  62           void Timer1_Init()             //100微秒@12.000MHz
  63          {
  64   1                              TMOD|=0x02;//八位重装模块
  65   1                              TH1=256;
  66   1                              TL1=256;//11.0592M晶振下最大比值是256，输出100HZ
  67   1                              TR1=1;//启动定时器1
  68   1                              ET1=1;//允许定时器1中断
  69   1                              EA=1;//总中断允许
  70   1      }
  71          void goForward()
  72          {
  73   1                      IN1= 1;  IN2=0;
  74   1                      IN3 = 0;        IN4=1;
  75   1              pwm_left_val=160;
  76   1              pwm_right_val=160;
  77   1                      timer1=12;
  78   1      }
  79          void goright(){
  80   1                      IN1= 1;  IN2=0;
  81   1                      IN3 = 0;        IN4=1;
  82   1              pwm_left_val=180;
  83   1              pwm_right_val=160;
  84   1              timer1=10;
  85   1      }
  86          void goleft(){
  87   1                      IN1= 1;  IN2=0;
  88   1                      IN3 = 0;        IN4=1;
  89   1              pwm_left_val=160;
  90   1              pwm_right_val=180;
  91   1              timer1=13;
  92   1      }
  93          void putleft(){
  94   1              IN1= 1;  IN2=0;
  95   1                      IN3 = 0;        IN4=1;
  96   1              pwm_left_val=205;
  97   1              pwm_right_val=175;
  98   1              timer1=14;
  99   1      }
 100          void putright(){
 101   1                      IN1= 1;  IN2=0;
 102   1                      IN3 = 0;        IN4=1;
 103   1              pwm_left_val=175;
 104   1              pwm_right_val=205;
 105   1              timer1=9;
 106   1      }
 107          void tracingMode()    
 108          {       
 109   1              if(xhg==1)     //确定是不是真检测到了
 110   1                              {
 111   2                              putleft();
 112   2                              delay1s();
 113   2                              putright();
 114   2                              delay1s();
 115   2                              goForward();
 116   2                              }
C51 COMPILER V9.54   AVOID                                                                 04/21/2023 20:43:48 PAGE 3   

 117   1              if(left_light==1&&middle_light==1&&right_light==1)//ȫۚ
 118   1              {
 119   2                      goForward();
 120   2              }
 121   1              if(left_light==0&&middle_light==1&&right_light==0)//ֱП
 122   1              {      
 123   2                      goForward();
 124   2              }
 125   1              if(left_light==1&&middle_light==0&&right_light==0)//ճԒת
 126   1              {
 127   2                      putright();
 128   2                              if(left_light==0&&middle_light==1&&right_light==0)
 129   2                              {
 130   3                              goForward();
 131   3                              }
 132   2              }
 133   1      
 134   1              if(left_light==0&&middle_light==0&&right_light==1)//ճسת
 135   1              {       
 136   2                              putleft();
 137   2                              if(left_light==0&&middle_light==1&&right_light==0)
 138   2                              {
 139   3                                      goForward();
 140   3                              }
 141   2              } 
 142   1              if(left_light==1&&middle_light==1&&right_light==0)
 143   1              {
 144   2                              goleft();
 145   2                      if(left_light==0&&middle_light==1&&right_light==0)
 146   2                      {
 147   3                      goForward();
 148   3                      }
 149   2              }
 150   1              if(left_light==0&&middle_light==1&&right_light==1)
 151   1              {
 152   2                      goright();
 153   2                      if(left_light==0&&middle_light==0&&right_light==0)
 154   2                      {
 155   3                              goForward();
 156   3                      }
 157   2              }
 158   1      }
 159          void main()
 160          {
 161   1               Timer0_Init();           
 162   1                      Timer1_Init();  
 163   1              while(1){
 164   2                      tracingMode();
 165   2                      }
 166   1              }
 167          
 168          
 169          void Time1_Init() interrupt 3
 170          {
 171   1              TR1=1;//启动定时器1
 172   1                              TH1=236;
 173   1                              TL1=236;//11.0592M晶振下最大比值是256，输出100HZ
 174   1                      pwm_t++; 
 175   1                      if(pwm_t==255)
 176   1                                      pwm_t=ENA=ENB=0;
 177   1                      if(pwm_left_val==pwm_t)
 178   1                                      ENA=1;
C51 COMPILER V9.54   AVOID                                                                 04/21/2023 20:43:48 PAGE 4   

 179   1                      if(pwm_right_val==pwm_t)
 180   1                                      ENB=1;
 181   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    377    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
