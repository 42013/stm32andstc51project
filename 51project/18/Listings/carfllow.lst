C51 COMPILER V9.54   CARFLLOW                                                              03/30/2023 20:30:24 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE CARFLLOW
OBJECT MODULE PLACED IN .\Objects\carfllow.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE carfllow.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ca
                    -rfllow.lst) TABS(2) OBJECT(.\Objects\carfllow.obj)

line level    source

   1          #include "reg52.h"
   2          #include <intrins.h>
   3          #include <string.h>
   4           
   5          sfr AUXR = 0x8E;
   6           
   7          sbit left_con1A = P1^1;
   8          sbit right_con1A = P1^3;
   9          sbit tracingLeft = P1^5;
  10          sbit tracingRight = P1^6;
  11           
  12          char leftSpeed;
  13          char rightSpeed;
  14          int cntLeft = 0;
  15          int cntRight = 0;
  16           
  17          //左电机反转
  18          void goLeftForward()
  19          {
  20   1        left_con1A = 1;
  21   1      }
  22           
  23          //左电机不转
  24          void goLeftStop()
  25          {
  26   1        left_con1A = 0;
  27   1      }
  28           
  29          //右电机反转
  30          void goRightForward()
  31          {
  32   1        right_con1A = 1;  
  33   1      }
  34           
  35          //右电机不转
  36          void goRightStop()
  37          {
  38   1        right_con1A = 0;  
  39   1      }
  40           
  41          //前进
  42          void goForward()
  43          {
  44   1        leftSpeed = 20;
  45   1        rightSpeed = 20;
  46   1      }
  47           
  48          //停止
  49          void goStop()
  50          {
  51   1        leftSpeed = 0;
  52   1        rightSpeed = 0;
  53   1      }
  54           
C51 COMPILER V9.54   CARFLLOW                                                              03/30/2023 20:30:24 PAGE 2   

  55          //左转
  56          void goLeft()
  57          {
  58   1        leftSpeed = 10;
  59   1        rightSpeed = 5;
  60   1      }
  61           
  62          //右转
  63          void goRight()
  64          {
  65   1        leftSpeed = 10;
  66   1        rightSpeed = 5;
  67   1      }
  68           
  69          void Timer0Init(void)   //1毫秒@11.0592MHz
  70          {
  71   1        AUXR &= 0x7F;   //定时器时钟12T模式
  72   1        TMOD &= 0xF0;   //设置定时器模式
  73   1        TMOD |= 0x01;   //设置定时器模式
  74   1        //定时器初值为1ms
  75   1        TL0 = 0x66;   
  76   1        TH0 = 0xFC;   
  77   1        TF0 = 0;    //清除TF0标志
  78   1        TR0 = 1;    //定时器0开始计时
  79   1        ET0 = 1;
  80   1        EA  = 1;
  81   1      }
  82           
  83          void Timer1Init(void)   //1毫秒@11.0592MHz
  84          {
  85   1        AUXR |= 0x40;   //定时器时钟1T模式
  86   1        TMOD &= 0x0F;   //设置定时器模式
  87   1        TMOD |= 0x10;   //设置定时器模式
  88   1        //定时器初值为1ms
  89   1        TL1 = 0xCD;   
  90   1        TH1 = 0xD4;   
  91   1        TF1 = 0;    //清除TF1标志
  92   1        TR1 = 1;    //定时器1开始计时
  93   1        ET1 = 1;
  94   1        EA  = 1;
  95   1      }
  96           
  97          void tracingMode()
  98          { 
  99   1        if(tracingLeft == 0 && tracingRight == 0){  //
 100   2          goForward();
 101   2        }
 102   1       
 103   1        if(tracingLeft == 0 && tracingRight == 1){
 104   2          goRight();
 105   2        }
 106   1       
 107   1        if(tracingLeft == 1 && tracingRight == 0){
 108   2          goLeft();
 109   2        }
 110   1       
 111   1        if(tracingLeft == 1 && tracingRight == 1){
 112   2          goStop();
 113   2        }
 114   1      }
 115           
 116          void main()
C51 COMPILER V9.54   CARFLLOW                                                              03/30/2023 20:30:24 PAGE 3   

 117          {
 118   1        Timer0Init();
 119   1        Timer1Init();
 120   1        while(1){
 121   2          tracingMode();
 122   2        }
 123   1      }
 124           
 125          //定时器0的中断函数
 126          void Time0Handler() interrupt 1
 127          {
 128   1        cntLeft++;
 129   1        TL0 = 0x66;   
 130   1        TH0 = 0xFC;
 131   1        if(cntLeft < leftSpeed)
 132   1        {
 133   2          goLeftForward();
 134   2        }else{
 135   2          goLeftStop();
 136   2        }
 137   1        if(cntLeft == 20){
 138   2          cntLeft = 0;
 139   2        }
 140   1      }
 141           
 142          void Time1Handler() interrupt 3
 143          {
 144   1        cntRight++;
 145   1        TL1 = 0x66;   
 146   1        TH1 = 0xFC;
 147   1        if(cntRight < rightSpeed)
 148   1        {
 149   2          goRightForward();
 150   2        }else{
 151   2          goRightStop();
 152   2        }
 153   1        if(cntRight == 20){
 154   2          cntRight = 0;
 155   2        }
 156   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    295    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
