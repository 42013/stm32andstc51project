C51 COMPILER V9.54   XHG                                                                   04/10/2023 21:29:56 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE XHG
OBJECT MODULE PLACED IN .\Objects\XHG.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE XHG.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\XHG.lst
                    -) TABS(2) OBJECT(.\Objects\XHG.obj)

line level    source

   1          #include "reg52.h"
   2          #include <intrins.h>
   3          
   4          sfr AUXR=0x80;
   5          sbit IN1 = P1^1;
   6          sbit IN2 = P1^2;
   7          sbit IN3 = P1^3;
   8          sbit IN4 = P1^4;
   9          sbit ENA  =P2^1;
  10          sbit ENB  =P2^2;
  11          sbit left_light = P1^5;
  12          sbit right_light = P1^6;
  13          sbit middle_light=P1^7;
  14          sbit PWM = P2^0;  //设定PWM输出的I/O端口
  15          sbit xhg  =P1^0;
  16          
  17          unsigned char pwm_left_val=210;
  18          unsigned char pwm_right_val=210;
  19          unsigned char pwm_t;
  20          unsigned char counter=0;
  21          unsigned char count = 0;
  22          unsigned char timer1 ;
  23          
  24          /*
  25          对于180°舵机
  26          t = 0.5ms——————-舵机会转动 0 ° 
  27          t = 1.0ms——————-舵机会转动 45°
  28          t = 1.5ms——————-舵机会转动 90°
  29          t = 2.0ms——————-舵机会转动 135°
  30          t = 2.5ms——————-舵机会转动 180°
  31          */
  32          
  33          void Timer0_Init()           
  34          {
  35   1          TMOD &= 0x00;
  36   1          TMOD |= 0x01; //定时器T0设置成方式1
  37   1       
  38   1          TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  39   1          TL0 = 0xa4;
  40   1       
  41   1          ET0 = 1;      
  42   1          TR0 = 1; 
  43   1        EA=1; 
  44   1        }
  45          void Time0_Init() interrupt 1 
  46          {
  47   1        TR0 = 0; 
  48   1        TH0 = 0xff;   //定时常数 0.1ms 晶振为11.0592MHz
  49   1          TL0 = 0xa4;
  50   1       
  51   1        if(count <= timer1) //5==0° 15==90°
  52   1        { 
  53   2          PWM = 1; 
  54   2        }
C51 COMPILER V9.54   XHG                                                                   04/10/2023 21:29:56 PAGE 2   

  55   1        else 
  56   1        { 
  57   2          PWM = 0; 
  58   2        }
  59   1        count++;
  60   1        if (count >= 200) //T = 20ms清零
  61   1        { 
  62   2          count = 0; 
  63   2        }
  64   1        TR0 = 1; //开启T0
  65   1      }
  66          
  67           void Timer1_Init()   //100微秒@12.000MHz
  68          {
  69   1        //TMOD &= 0x0F;   //设置定时器模式
  70   1        //TL1 = 0x50;   //设置定时初值
  71   1        //TH1 = 0xFB;   //设置定时初值
  72   1        //TF1 = 0;     //清除TF1标志
  73   1        //TR1 = 1;    //定时器1开始计时
  74   1        //EA  = 1;
  75   1        //ES  = 1;
  76   1            TMOD|=0x02;//八位重装模块
  77   1            TH1=256;
  78   1            TL1=256;//11.0592M晶振下最大比值是256，输出100HZ
  79   1            TR1=1;//启动定时器1
  80   1            ET1=1;//允许定时器1中断
  81   1            EA=1;//总中断允许
  82   1      }
  83          
  84          /*延时程序*/
  85          /*void delay1s()   //误差 0us
  86          {
  87              unsigned char a,b,c;
  88              for(c=167;c>0;c--)
  89                  for(b=171;b>0;b--)
  90                      for(a=16;a>0;a--);
  91              _nop_();  //if Keil,require use intrins.h
  92          }*/
  93           void delay(unsigned int xms)   //@12.000MHz
  94          { 
  95   1        unsigned char i;
  96   1        while(xms--)
  97   1        {
  98   2        _nop_();
  99   2        i = 2;
 100   2        while (--i);
 101   2        }
 102   1      }
 103          
 104          /*定时器T0初始化*/
 105          
 106          void goForward()
 107          {
 108   1          IN1= 0;  IN2=1;
 109   1          IN3 = 1;  IN4=0;
 110   1        pwm_left_val=130;
 111   1        pwm_right_val=130;
 112   1          timer1=12;
 113   1      }
 114          /*void godown1()
 115          {
 116              IN1= 1;  IN2=0;
C51 COMPILER V9.54   XHG                                                                   04/10/2023 21:29:56 PAGE 3   

 117              IN3 =0; IN4=1;
 118            pwm_left_val=110;
 119            pwm_right_val=110;
 120              timer1=10;
 121          }*/
 122          /*void godown2()
 123          {
 124              IN1= 1;  IN2=0;
 125              IN3 =0; IN4=1;
 126            pwm_left_val=110;
 127            pwm_right_val=110;
 128              timer1=14;
 129          }*/
 130          void gostop()
 131          {
 132   1          IN1= 0;  IN2=0;
 133   1          IN3 = 1;  IN4=1;
 134   1          timer1=12;
 135   1      }
 136          void goright(){
 137   1        IN1= 0;  IN2=1;
 138   1          IN3 = 1;  IN4=0;
 139   1        pwm_left_val=140;
 140   1        pwm_right_val=120;
 141   1        timer1=11;
 142   1      }
 143          void goleft(){
 144   1          IN1= 0;  IN2=1;
 145   1          IN3 = 1;  IN4=0;
 146   1        pwm_left_val=120;
 147   1        pwm_right_val=140;
 148   1        timer1=13;
 149   1      }
 150          void putleft(){
 151   1        IN1= 0;  IN2=1;
 152   1          IN3 = 1;  IN4=0;
 153   1        pwm_left_val=145;
 154   1        pwm_right_val=115;
 155   1        timer1=14;
 156   1      }
 157          void putright(){
 158   1          IN1= 0;  IN2=1;
 159   1          IN3 = 1;  IN4=0;
 160   1        pwm_left_val=115;
 161   1        pwm_right_val=145;
 162   1        timer1=9;
 163   1      }
 164          void tracingMode()    
 165          { 
 166   1        if(left_light==1&&middle_light==1&&right_light==1)//ȫۚ 
 167   1        {
 168   2          goForward();
 169   2        }
 170   1        if(left_light==0&&middle_light==1&&right_light==0)//ֱП
 171   1        {      
 172   2          goForward();
 173   2        }
 174   1        if(left_light==1&&middle_light==0&&right_light==0)//ճԒת
 175   1        {
 176   2          putleft();
 177   2            if(left_light==0&&middle_light==1&&right_light==0)
 178   2            {
C51 COMPILER V9.54   XHG                                                                   04/10/2023 21:29:56 PAGE 4   

 179   3            goForward();
 180   3            }
 181   2        }
 182   1      
 183   1        if(left_light==0&&middle_light==0&&right_light==1)//ճسת
 184   1        { 
 185   2            putright();
 186   2            if(left_light==0&&middle_light==1&&right_light==0)
 187   2            {
 188   3              goForward();
 189   3            }
 190   2        } 
 191   1        if(left_light==1&&middle_light==1&&right_light==0)
 192   1        {
 193   2            goleft();
 194   2          if(left_light==0&&middle_light==1&&right_light==0)
 195   2          {
 196   3          goForward();
 197   3          }
 198   2        }
 199   1        if(left_light==0&&middle_light==1&&right_light==1)
 200   1        {
 201   2          goright();
 202   2      
 203   2          if(left_light==0&&middle_light==0&&right_light==0)
 204   2          {
 205   3            goForward();
 206   3          }
 207   2        }
 208   1      }
 209          void avoid(){
 210   1        if(xhg==1)     //确定是不是真检测到了
 211   1            {
 212   2            gostop();
 213   2            delay(50);
 214   2            putleft();
 215   2            delay(2000);
 216   2            goForward();
 217   2          }
 218   1      }
 219          void main()
 220          {
 221   1         Timer0_Init();           
 222   1          Timer1_Init();
 223   1            while(1){
 224   2            tracingMode();
 225   2            avoid();  
 226   2        }
 227   1      }
 228          
 229          void Time1_Init() interrupt 3
 230          {
 231   1            TR1=1;//启动定时器0
 232   1            TH1=236;
 233   1            TL1=236;//11.0592M晶振下最大比值是256，输出100HZ
 234   1          pwm_t++;
 235   1          if(pwm_t==225)
 236   1              pwm_t=ENA=ENB=0;
 237   1          if(pwm_left_val==pwm_t)
 238   1              ENA=1;
 239   1          if(pwm_right_val==pwm_t)
 240   1              ENB=1;
C51 COMPILER V9.54   XHG                                                                   04/10/2023 21:29:56 PAGE 5   

 241   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    407    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
